#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤ API –≤ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ

set -e

echo "üîÑ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ API Foodgram –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ..."

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å –ø—Ä–æ–µ–∫—Ç–æ–º
cd "$(dirname "$0")/.."

# –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã –≤ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
docker-compose -f infra/docker-compose.yml run --rm backend python -m pytest

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
if [ $? -eq 0 ]; then
  echo "‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!"
else
  echo "‚ùå –¢–µ—Å—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —Å –æ—à–∏–±–∫–∞–º–∏."
  exit 1
fi
